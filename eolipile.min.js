"use strict";var Eolipile=function(){this._ID=1;this._RUNNING=false;this._PILE=[];this._requestNextLoop=false;if(!!window)this._webContextInit();if(!this._requestNextLoop)this._workerContextInit();this.lastTime=0;return this};Eolipile.prototype._webContextInit=function(){var vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x)this._requestNextLoop=window[vendors[x]+"RequestAnimationFrame"];return};Eolipile.prototype._workerContextInit=function(){this._requestNextLoop=function(callback,element){var currTime=Date.now();var timeToCall=Math.max(0,16-(currTime-this.lastTime));setTimeout(function(){callback(currTime+timeToCall)},timeToCall);this.lastTime=currTime+timeToCall;return this}};Eolipile.prototype._loop=function(start){var newPile=[];for(var pileSize=this._PILE.length;pileSize;pileSize--){try{var process=this._PILE.pop();if(process.counter<=start){var replay=process.callback();if(replay){process.counter=start+process.timer;newPile.push(process)}else if(process.endCallback){process.endCallback()}}else newPile.push(process)}catch(e){var level=typeof e.level!="undefined"?e.level:2;var message=e.message||e;var datas=e.datas||e.stack||e}}if(newPile.length){this._PILE=newPile;this._requestNextLoop(this._loop.bind(this));return}this._RUNNING=false};Eolipile.prototype.start=function(){if(this._RUNNING||!this._PILE.length)return;this._requestNextLoop(this._loop.bind(this));this._RUNNING=true;return this};Eolipile.prototype.append=function(process){try{if(typeof process!=="object")throw"Not an object!";if(!!process.timer&&!!process.callback&&typeof process.callback==="function"){process.id=this._ID;process.counter=Date.now()+process.timer;this._ID++;this._PILE.push(process);if(!this._RUNNING)this.start();return process.id}else throw"Missing parameters"}catch(e){}return};Eolipile.prototype.setTimeout=function(callback,duration){if(typeof callback!=="function"||typeof duration!=="number"){return this}this.append({timer:duration,run:callback});return this};Eolipile.prototype.get=function(id){var pile=this._PILE;if(!pile.length)return false;var len=pile.length;while(len){len--;if(pile[len].id===id)return this._PILE[len]}return false};Eolipile.prototype.end=function(id){var process=this.get(id);process.callback=function(){return false};process.counter=0;return};Eolipile.prototype.kill=function(id){var process=this.get(id);this.end(id);process.endCallback=false;return};Eolipile.prototype.flush=function(){var id,len=this._PILE.length;if(!len)return;while(len){len--;console.log(len);this.kill(this._PILE[len].id)}return};